---
title: æ–‡ç« 
date: 2021-08-01 14:55:07
permalink: /pages/3b8997/
categories:
  - ä¸»é¢˜å¼€å‘
  - å¿«é€Ÿå…¥é—¨
tags:
  - 
---
> æ–‡ç« ç•Œé¢ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„å†…å®¹ï¼Œç”¨æ¥æ˜¾ç¤ºæ–‡ç« çš„è¯¦ç»†ä¿¡æ¯

è¿™ä¸ªåœ¨æ ¹ç›®å½•ä¸‹çš„ `post.php` ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨å„ç§å‡½æ•°æ¥è·å–æ–‡ç« çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œå¯ä»¥è‡ªå·±åˆ°APIå‚è€ƒç« èŠ‚æŸ¥çœ‹ã€‚

## åŠ å¯†å†…å®¹

è¿™é‡Œæˆ‘è¯´ä¸€ä¸‹åŠ å¯†æ–‡ç« çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `get_post_encrypt` åˆ¤æ–­æ–‡ç« æ˜¯å¦åŠ å¯†ï¼Œå¦‚æœåŠ å¯†æˆ‘ä»¬å°±æ˜¾ç¤ºä¸€ä¸ªå¯†ç è¾“å…¥æ¡†è®©ç”¨æˆ·è¾“å…¥å¯†ç ï¼Œæ³¨æ„è¿™ä¸ªinputçš„nameæ˜¯ `password` ï¼Œç”¨æˆ·è¾“å…¥å¯†ç å `get_post_encrypt` å°±ä¼šå˜æˆ `false` ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥è°ƒç”¨ `post_content` æ¥æ˜¾ç¤ºæ–‡ç« å†…å®¹äº†

```php+HTML
<div class="entry-content">
    <?php if (get_post_encrypt()): ?>
    <form action="" class="post-password-form" method="get">
        <p>è¿™æ˜¯ä¸€ç¯‡å—å¯†ç ä¿æŠ¤çš„æ–‡ç« ï¼Œæ‚¨éœ€è¦æä¾›è®¿é—®å¯†ç ï¼š</p>
        <p><label for="pwbox-7">å¯†ç ï¼š <input name="password" id="pwbox-7" type="password" size="20"></label> <input type="submit" value="æäº¤"></p>
    </form>
    <?php else: post_content(); endif;?>
</div>
```

## æ–‡ç« è¯„è®º

æ–‡ç« è¯„è®ºæ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œå¤§å®¶å¯ä»¥è°ƒç”¨ä¸‹é¢è¿™ä¸ªå‡½æ•°æ¥è·å–æ–‡ç« çš„è¯„è®ºå†…å®¹

```php
<?php xy_comments(get_post_id()); 
```

è€Œè¯„è®ºéƒ¨åˆ†çš„ä»£ç åœ¨ `content/comments.php` è¿™ä¸ªæ–‡ä»¶é‡Œã€‚è¯„è®ºéƒ¨åˆ†æœ€éš¾çš„å°±æ˜¯åµŒå¥—è¯„è®ºçš„é—®é¢˜ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯æœ€ç®€å•çš„æš´åŠ›é€’å½’çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…¶å®å¾ˆæ¶ˆè€—æ€§èƒ½ï¼Œä¸è¿‡å¥½åœ¨ç½‘ç«™çš„è¯„è®ºä¸€èˆ¬ä¸ä¼šå¾ˆå¤šï¼Œåç»­å¯èƒ½ä¼šè€ƒè™‘ä¼˜åŒ–ã€‚ä¸‹é¢è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘çš„å¤„ç†æ–¹æ³•ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æƒ³åˆ«çš„æ–¹æ³•æ¥å®ç°ã€‚

é¦–å…ˆæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªæ˜¾ç¤ºè¯„è®ºæ¡†ç•Œé¢çš„å‡½æ•°ï¼Œè¿™ä¸ª$show å¯ä»¥ç”¨æ¥æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå›å¤æŒ‰é’®

```php+HTML
function echoComment($comment,$show = true)
    {
    $postId = get_post_id();
        echo <<<EOF
<div class="contents">
    <div class="comment-arrow">
        <div class="main">
            <div class="profile">
                <a href="javascript: return false;" rel="nofollow">
                    <img src="https://cdn.jsdelivr.net/gh/moezx/cdn@3.0.2/img/svg/loader/trans.ajax-spinner-preloader.svg" onerror="imgError(this,1)" data-src="${comment["avatar"]}" class="lazyload avatar avatar-24 photo" alt="ğŸ˜€" width="24" height="24">
                </a>
            </div>
            <div class="commentinfo">
                <section class="commeta">
                    <div class="left">
                        <h4 class="author">
                          <a href="javascript: return false;" rel="nofollow">
                            ${comment["nickname"]}
                            <span class="showGrade0" title="èŒèŒå“’æ–°äºº~">
                                <img src="https://cdn.jsdelivr.net/gh/moezx/cdn@3.1.9/img/Sakura/images/level/level_${comment["level"]}.svg" style="height: 1.5em; max-height: 1.5em; display: inline-block;">
                            </span>
                           </a>
                        </h4>
                    </div>
EOF;
        if ($show){
            echo "<a rel=\"nofollow\" class=\"comment-reply-link\" href=\"#comment-${comment["id"]}\" data-commentid=\"${comment["id"]}\" data-postid=\"$postId\" data-belowelement=\"comment-${comment["id"]}\" data-respondelement=\"respond\">Reply</a>";
        }
echo <<<EOF
                    <div class="right">
                        <div class="info">
                            <time datetime="2020-03-01">å‘å¸ƒäº ${comment["date"]}</time>
                        </div>
                    </div>
                </section>
            </div>
            <div class="body">
                <p>${comment["content"]}</p>
            </div>
        </div>
        <div class="arrow-left"></div>
    </div>
</div>
EOF;
    }
```

ä¸‹é¢å°±æ˜¯åµŒå¥—è¯„è®ºçš„éƒ¨åˆ†ï¼Œæˆ‘è¿™è¾¹ç»Ÿä¸€å»ºè®®æœ€å¤šå¯ä»¥åµŒå¥—5å±‚ï¼Œå¤šäº†ä¸å¥½æ˜¾ç¤ºï¼Œå°‘äº†ä¹Ÿä¸æ–¹ä¾¿ï¼Œå¤§å®¶è‡ªå·±é€‰æ‹©å°±å¥½ï¼Œæˆ‘çš„å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š

```php+HTML
<?php $comments = get_post_comments();
foreach ($comments as $comment){
    if ($comment["parent"]==0){
        echo '<li class="comment even thread-even depth-1" id="comment-"'.$comment["id"].'>';
        echoComment($comment);
        echo '<hr><ul class="children">';
        foreach ($comments as $comment2){
            if ($comment2["parent"]==$comment["id"]){
                echo '<li class="comment odd alt depth-2" id="comment-"'.$comment2["id"].'>';
                echoComment($comment2);
                echo '<hr><ul class="children">';
                foreach ($comments as $comment3){
                    if ($comment3["parent"]==$comment2["id"]){
                        echo '<li class="comment odd alt depth-3" id="comment-"'.$comment3["id"].'>';
                        echoComment($comment3);
                        echo '<hr><ul class="children">';
                        foreach ($comments as $comment4){
                            if ($comment4["parent"]==$comment3["id"]){
                                echo '<li class="comment odd alt depth-4" id="comment-"'.$comment4["id"].'>';
                                echoComment($comment4);
                                echo '<hr><ul class="children">';
                                foreach ($comments as $comment5){
                                    if ($comment5["parent"]==$comment4["id"]){
                                        echo '<li class="comment odd alt depth-5" id="comment-"'.$comment5["id"].'>';
                                        echoComment($comment5,false);
                                    }
                                }
                                echo '</ul></li>';
                            }
                        }
                        echo '</ul></li>';
                    }
                }
                echo '</ul></li>';
            }
        }
        echo '</ul></li>';
    }
}
?>
```



## owoè¡¨æƒ…

åšå®¢ç³»ç»Ÿè‡ªå¸¦è¡¨æƒ…ï¼Œæ‰€ä»¥æˆ‘è¿™è¾¹ç»Ÿä¸€å»ºè®®ä½¿ç”¨åšå®¢ç³»ç»Ÿè‡ªå¸¦çš„æ¥è¿›è¡Œæ˜¾ç¤ºã€‚è‡ªå¸¦çš„åç»­å¯ä»¥æ‰©å±•ï¼Œå¦‚æœè‡ªå·±å®ç°çš„è¯ï¼Œä¸å¥½ç»´æŠ¤ã€‚

ä½¿ç”¨ `tools_get_smile();` æ¥è·å–è¡¨æƒ…ä¿¡æ¯ï¼Œè¡¨æƒ…çš„ç»“æ„ä¿¡æ¯å¦‚ä¸‹

```json
{
    "bilibili": {
        "type": "images",
        "container": [
            {
                "desc": "':bilibili0:'",
                "icon": "<img title=\":bilibili0:\" class=\"x-owo-icon\" src=\"http://192.168.123.119/assets/images/smilies/bilibili/0.png\"/>",
                "text": ""
            }
        ]
    },
    "å°ç”µè§†": {
        "type": "images",
        "container": [
            {
                "desc": "':tv1:'",
                "icon": "<img title=\":tv1:\" class=\"x-owo-icon\" src=\"http://192.168.123.119/assets/images/smilies/bilibili_tv/tv_1.png\"/>",
                "text": ""
            }
        ]
    },
    "é¢œæ–‡å­—": {
        "type": "emoticon",
        "container": [
            {
                "desc": "'OÏ‰O'",
                "icon": "<span title=\"OÏ‰O\" class=\"x-owo-icon\">OÏ‰O</span>",
                "text": "Author: DIYgod"
            }
        ]
    }
}
```

`desc` æ˜¯è¡¨æƒ…çš„ä»£ç ï¼Œæˆ‘ä»¬åœ¨è¯„è®ºä¸­æ’å…¥è¿™ä¸ªæ–‡æœ¬ååœ¨æ˜¾ç¤ºè¡¨æƒ…çš„æ—¶å€™ç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œè½¬ä¹‰ï¼Œicon æ˜¯è¡¨æƒ…å†…å®¹ï¼Œè‡ªå¸¦htmlæ ‡ç­¾ï¼Œæˆ‘ä»¬è‡ªå·±æ˜¾ç¤ºå°±å¯ä»¥äº†ã€‚textæ˜¯è¡¨æƒ…çš„æè¿°ï¼Œå…¶å®å¯ä»¥ä¸éœ€è¦ã€‚

å…¶å®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`owo`è¿™ä¸ªæ’ä»¶æ¥æ˜¾ç¤ºæˆ‘ä»¬çš„è¡¨æƒ…ï¼Œè¿™æ ·å°±ä¸ç”¨è‡ªå·±å†™å¤„ç†é€»è¾‘äº†ï¼Œå…³é”®ä»£ç 

```javascript
	new OwO({
		logo: 'OÏ‰Oè¡¨æƒ…',
		container: document.getElementsByClassName('OwO')[0],
		target: document.getElementById('comment'),
		api: '/api/v3/tools/smiles',
		position: 'up',
		width: '100%',
		maxHeight: '250px'
	})
```

è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡apiæ¥å£è‡ªåŠ¨è·å–è¡¨æƒ…ä¿¡æ¯ï¼Œç„¶åæŒ‡å®šéœ€è¦æ˜¾ç¤ºçš„å®¹å™¨ã€‚ç›¸å…³çš„jsä»£ç å’Œæ ·å¼å¯ä»¥å‚è€ƒå®˜æ–¹ä¸»é¢˜çš„

`theme.js` å†…å®¹

![image-20210801151943559](https://img.xiaoyou66.com/2021/08/01/37f53e43cc85d.png)

## å‘è¡¨è¯„è®º

è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„åœ°æ–¹ã€‚éœ€è¦è€ƒè™‘ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œä»¥åŠæ–‡ç« idï¼Œå›å¤æŸä¸ªç”¨æˆ·æ—¶ç”¨æˆ·çš„idã€‚å‘è¡¨è¯„è®ºéœ€è¦ä½¿ç”¨åšå®¢ç³»ç»Ÿçš„æ¥å£æ¥è¿›è¡Œå‘é€ï¼Œä¸‹é¢è¿™ä¸ªæ˜¯`sakura`çš„å¤„ç†é€»è¾‘ï¼Œè¿™ä¸ªå…¶å®å€¼è´´äº†ä¸€éƒ¨åˆ†ã€‚

```javascript
jQuery(document).on("submit", "#commentform", function() {
    // è·å–è¯„è®ºçš„å„é¡¹ä¿¡æ¯
    let comments = {
        parent: parseInt($('#comment_parent').val()),
        name: $('input#author').val(),
        content: $('textarea#comment').val(),
        site: $('input#url').val(),
        email: $('input#email').val()
    }
    // å‘é€çš„å¤´éƒ¨ä¿¡æ¯
    let head = []
    // åˆ¤æ®µç”¨æˆ¶æ˜¯å¦ç™»å½•
    if (mashiro_option.islogin){
        const info = JSON.parse(mashiro_option.userInfo);
        comments.avatar = info.avatar;
        comments.hang = info.hang;
        comments.email = info.email;
        comments.name = info.nickname;
        comments.user_id = info.user_id
        // è·å–ç™»å½•token
        let token = JSON.parse(xy.tools.getCookie('token'));
        head = {'user_id': token["user_id"], 'token': token['token']};
    } else if (getCookie('user_uid')){
        // åˆ¤æ–­æœ‰æ²¡æœ‰Bç«™UID
        comments.uid = getCookie('user_uid');
        comments.avatar = getCookie('user_avatar');
        comments.level = getCookie('user_level');
        comments.hang = getCookie('user_hang');
    }
    jQuery.ajax({
        method: "POST",
        headers: head,
        url: mashiro_option.site_url + `/api/v3/posts/${$('#comment_post_ID').val()}/comments`,
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(comments),
        beforeSend: addComment.createButterbar("æäº¤ä¸­(Commiting)...."),
        error: function(res) {
            addComment.createButterbar(JSON.parse(res.responseText).message);
        },
        success: function(data) {
            addComment.createButterbar("æäº¤æˆåŠŸ(Succeed)");
            setTimeout(function (){window.location.reload()},1000)
        }
    });
    return false;
});
```

æ›´è¯¦ç»†çš„ä¿¡æ¯å¯ä»¥å‚è€ƒæ–‡ç« å‘å¸ƒè¯„è®ºçš„æ¥å£

![image-20210801152616502](https://img.xiaoyou66.com/2021/08/01/88be7eefe7de2.png)

bodyå‚æ•°å¦‚ä¸‹

![image-20210801152629457](https://img.xiaoyou66.com/2021/08/01/1d68ae3c6aefe.png)



å…³é”®çš„éƒ¨åˆ†è‡ªå·±å¤šå¤šçœ‹çœ‹ä»£ç ï¼Œå› ä¸ºç»†èŠ‚éƒ¨åˆ†æ¯”è¾ƒå¤šï¼Œæˆ‘è¿™é‡Œä¹Ÿå¾ˆéš¾ç”¨æœ‰é™çš„ç¯‡å¹…æ¥è¯´æ˜ã€‚

